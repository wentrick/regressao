---
title: "Exercicio Regressao Multipla Sala"
author: "Davi Wentrick Feijó - 200016806"
date: "2023-06-02"
output:
  html_document:
    df_print: paged
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
pacman::p_load(tidyverse,Matrix,knitr)
```

### Regressao Linear Multipla

Vamos usar esses dados:
```{r echo=FALSE}
#modelo linear multiplo
area = c(1:15)
safra_de_trigo = c(40,38,50,49,50,55,70,55,45,65,72,70,65,80,75)
fertilizante = c(100,150,200,250,300,350,400,410,450,500,550,600,650,700,800)
chuva = c(10,10,20,20,10,20,30,20,10,20,20,30,20,30,30)

dados = data.frame(area,safra_de_trigo,fertilizante,chuva) 

dados2 <- dados %>% #somente para ficar bonito no documento
  rename("Area" = area , "Safra de Trigo" = safra_de_trigo ,"Fertilizante" = fertilizante , "Chuva" = chuva )
```


```{r echo=FALSE}
#kable(dados,col.names = c('Area', 'Safra de Trigo', 'Fertilizante', 'Chuva')) 
dados2
```

#### Especificar os elementos dos vetores e matrizes do problema 

```{r}
n <- nrow(dados) # Number of observations
n
```


Nosso Y será a safra de trigo:

```{r echo=FALSE}
Y <- dados$safra_de_trigo
Y <- as.matrix(Y)
Y
```


E o X será o fertilizante e o indice de chuvas:

```{r echo=FALSE}
X <- cbind(dados$fertilizante,dados$chuva)
X
```

podemos adicionar na matriz X o vetor de 1 para ser nosso intecepto.

```{r}
X <- cbind(rep(1,n), X) 
X                     
```

Vamos definir nossa matris J que sera com composta inteiramente por 1 e sera $n \times n$ (n sendo o numero de observacoes)

```{r}
J = matrix(data = 1, nrow = n, ncol = n)
head(J)
```


Agora podemos encontrar nosso vetor de Betas sabendo que ele pode ser calculado da seguinte forma:

$$
\beta = (X^TX)^{-1}X^TY
$$
```{r}
#encontrando XTX

XTX = t(X) %*% X
XTX

#encontrando XTY

XTY = t(X) %*% Y
XTY

#encontrando a inversa de XTX

XTX_inv = solve(XTX)
XTX_inv

#encnontrando a matriz de parametros Beta (ela contem o Beta 0 e o Beta 1 ou todos os beta no caso de uma regressao multipla)

beta = XTX_inv %*% t(X) %*% Y #em partes

beta = solve(t(X) %*% X) %*% t(X) %*% Y #direto

beta
```


Com a matriz de betas podemos ajustar os valores esperados do modelo $\hat Y$:

```{r}
#valores estimados pelo modelo (y chapeu)
Yhat <- X %*% beta # Fitted Values
Yhat
```

Em seguida podemos calcular nossos residuos

```{r}
#residuos do modelo
e <- Y - Yhat # Residuals
e
```

Podemos realizar a ANOVA do modelo para isso precisaremos calcular as seguintes somas de quadrados

* Soma de quadrados da regressao (SSR ou SQR)
  + $\hat{\beta}^TX^TY-\frac{1}{n}Y^TJY$
* Soma de quadrados do residuo (SSE ou SQE)
  + $\varepsilon^T\varepsilon$ ou $Y^TY-\hat{\beta}^TX^TY$
* Soma de quadrados total (SST ou SQT)
  + $SSE+SSR$
  
```{r}
sse = t(e) %*% e #soma de quadrados do residuo
sse = t(Y) %*% Y - t(beta) %*% t(X) %*% Y #segunda forma de calcular
sse

ssr = t(beta) %*% t(X) %*% Y - (1/n) * (t(Y) %*% J %*% Y) #soma de quadrados da regressao
ssr

sst = ssr +sse  #soma de quadrados total
sst
```

Em seguida temos que encontrar os quadrados medios:

* Quadrado Médio da regressao (MSR ou QMR)
  + $\frac{SSR}{p-1}$
* Quadrado Médio do residuo (MSE ou QME)
  + $\frac{SSE}{n-p}$

Onde $n$ é o número de observacoes e $p$ o número de parametros (variaveis) do modelo

```{r}
p = length(beta)
```


```{r}
mse = sse/(p-1)
mse
```

```{r}
msr = ssr/(n-p)
msr
```



