---
title: "Relatório Final"
subtitle: "Análise de Regressao Linear"
author: "Davi Wentrick Feijó"
header_left: "Runninghead"
header_right: "Author"
date: \today
fontsize: 11pt
german: false # default is Englisht
output: 
  UHHformats::pdf_simple:
    toc: true
    toc_depth: 3
    font: "Helvetica" # alternative: "TheSansUHH"  
---

```{r setup, include = FALSE}
# settings --> keep this chunk as it is!
knitr::opts_chunk$set(echo = FALSE, message = FALSE, 
  warning = FALSE, error = FALSE, cache = TRUE,
  fig.path='figs/', cache.path = 'cache/')
```

```{r load-packages, include = FALSE}
# packages
pacman::p_load(knitr,kableExtra,xtable,plyr,tidyverse,readxl,olsrr,ggpubr,kableExtra,ggthemes,dplyr)

dados <- read_excel("DADOS_TRABALHO_2023_1.xlsx")
set.seed(361)
#formatando o banco

dados = dados %>%
  mutate(ID = as.numeric(ID),
         X5 = as.factor(X5),
         X7 = as.factor(X7),
         X9 = as.factor(X9),
         X11 = as.factor(X11)) %>%
  select(-ID)



amostra = sample_n(dados, 300)


# Supondo que você tenha os dados nas colunas x1 (valor da casa) e x2 (presença de ar condicionado) no dataframe "dados"
# Crie o gráfico de dispersão com cores para representar a presença ou ausência de ar condicionado
x1<- dados$X1
x5<-dados$X5
```

```{r generate-package-refs, include=FALSE}
# Create a bib database for R packages used above
# NOTE: RUN THIS CODE CHUNK MANUALLY TO CREATE FILE BEFORE KNITTING
knitr::write_bib(
  x = c(.packages(), 'bookdown', 'rmarkdown', 'UHHformats',
    # Add here now all packages that are loaded above:
    'knitr', 'kableExtra', 'xtable', 'tidyverse'),
  file = 'bib/packages.bib'
)
```


<!-- This is how you can define comments in an .Rmd file (outside the R code snippets) -->


# Introdução


Nesse estudo, analisaremos um conjunto de dados de uma cidade americana, composta por informações de venda de 522 que foram vendidas no último ano. O propósito desse estudo é a construção de um modelo preditivo que busca prever a média da venda das casas anunciadas, dado algumas características da casa.

O trabalho possui como estrutura a segunda seção com analise descritiva das variáveis, a terceira seção conta com a seleção de variáveis a serem adotadas no modelo. O modelo junto com sua validação se encontra na seção quatro e, por fim, os resultados são apresentados na seção cinco.

\newpage

# Objetivos

Para esse trabalho, usaremos Regressivo Linear Múltipla no banco de dados que apresenta informações observacionais sobre onze características diferentes de cada casa. Para podermos ter controle sobre o modelo, dividimos a amostra em 2 partes, a primeira, composta por 300 amostras selecionadas aleatoriamente, para a construção do modelo, e a segunda com as 222 restantes visando a validação do modelo preditivo.

Como forma de mensurar a seleção de variáveis do modelo usaremos na seleção de variáveis os critérios R², Cp de Mallows e regressão “Stepwise”. As variáveis que constam no banco de dados são o preço de venda, tamanho da casa, número de quartos, número de banheiros, presença de ar-condicionado, tamanho da garagem, presença de piscina, idade de casa, obtida a partir do ano de construção, qualidade da construção, tamanho do terreno e proximidade da "Highway"(proximidade da rodovia). Essas variáveis representam elementos que podem influenciar o preço de venda das casas.

\newpage

# Metodologia

\newpage

# Resultados 

## Analise descritiva das variáveis 


### Valor de Venda - Variavel Resposta - X1
```{r}
# Crie o histograma com cores personalizadas
options(scipen = 999)

hist(dados$X1, 
     main = "Histograma dos Valores de Venda", 
     xlab = "Valor de Venda",
     col = "steelblue",  # Cor das barras
     border = "white",   # Cor das bordas das barras
     breaks = 20         # Número de bins
)
```
```{r}
qqnorm(dados$X1)
qqline(dados$X1)
```


```{r}
summary(dados$X1)
```

```{r}
shapiro.test(dados$X1)
```

Das onze variáveis apresentadas no banco de dados, a variável preço de venda é nossa variável resposta, sendo ela uma variável quantitativa e continua, que apresenta como medidas as seguintes:

O que nos mostra que a maior parte dos preços estão concentrados na faixa 180.000 até 230.000, conforme podemos observar no gráfico 1
   
Nossa variável embora não pareça seguir uma distribuição normal, pelo método de Shapiro-Wilk vemos que ela segue a normal e possui uma calda alongada dado por possuir um valor outlier (920.000).

\newpage

### Tamanho da Casa - X2



```{r}
#histograma do Tamanho da casa:
hist(dados$X2, 
     main = "Histograma do Tamanho da casa", 
     xlab = "Tamanho da casa",
     col = "steelblue",  # Cor das barras
     border = "white",   # Cor das bordas das barras
     breaks = 20         # Número de bins
)
```

```{r}
ggplot(dados,aes(dados$X1,dados$X2, color = I("steelblue"))) +
  geom_point() + 
  theme_classic()+
  stat_cor(method = "pearson")+
  labs(title = "Gráfico de Dispersão - Tamanho da casa",y = "Valor da casa", x="Tamanho da casa")
```



```{r}
summary(dados$X2)
```


```{r}
shapiro.test(dados$X2)
```
A variável tamanho da casa, também é uma variável quantitativa e continua, medida em Pés-quadrado e que apresenta como medidas: 




 Observa-se que o maior valor é 5.032 pés-quadrado o que difere da média, a maior parte dos valores estão concentrados na faixa próxima de 2.000 pés, juntamente temos o histograma de dispersão em relação a variável resposta, conforme seguem os gráficos abaixo:
 
\newpage 
 
###  Número de Quartos - X3


```{r}
cores_azul <- c("#1f77b4", "#aec7e8", "#9edae5", "#3182bd", "#6baed6", "#bdd7e7", "#6baed6")

#box plot 
ggplot(dados, aes(x = factor(X3), y = X1, fill = factor(X3))) +
  geom_boxplot() +
  scale_fill_manual(values = cores_azul, name = "Número de quartos") +  # Personalizar o nome da legenda
  theme_classic() +
  labs(title = "Box Plot - Número de quartos na casa",
       y = "Valor da casa",
       x = "Número de quartos") +
  scale_x_discrete(limits = 1:7)+  # Limitar o eixo x até o valor 7
  theme(legend.position = "none")
```

```{r}
tabela_frequencias <- as.data.frame(dados) %>%
  group_by(X3) %>%
  dplyr::summarise(frequencia = n()) %>%
  mutate(percentual = frequencia / sum(frequencia) * 100)
colnames(tabela_frequencias) = c("Número de quartos","Frequencia","Porcentual")
```

```{r, results = "asis", eval=ifelse(nzchar(system.file(package = "xtable")), TRUE, FALSE)}
xt <- xtable(tabela_frequencias, caption = "Tabela de frequencia do Número de quartos", 
  label = "tab:xtable_tab")
print(xt, comment = FALSE, caption.placement = "top", booktabs = TRUE)
```

```{r}
shapiro.test(dados$X3)
```

Nossa terceira variável refere-se ao número de quartos que as casas estudadas possuíam, acredita-se que casas com maior número de quartos são mais valorizadas, essa variável é uma variável quantitativa discreta com casas possuindo entre 0 e 7 quartos conforme tabela abaixo:

Número de quartos	Quantidade
0	1
1	9
2	64
3	202
4	175
5	52
6	12
7	3

Ao se observar o gráfico x vemos que a variável segue uma distribuição normal, que se comprova ao aplicar o teste de normalidade.

\newpage

### Número de Banheiros - X4

```{r}
cores_azul <- c("#1f77b4", "#aec7e8", "#9edae5", "#3182bd", "#6baed6", "#bdd7e7", "#6baed6")

#box plot 
ggplot(dados, aes(x = factor(X4), y = X1, fill = factor(X4))) +
  geom_boxplot() +
  scale_fill_manual(values = cores_azul, name = "Número de banheiros") +  # Personalizar o nome da legenda
  theme_classic() +
  labs(title = "Box Plot - Número de banheiros na casa",
       y = "Valor da casa",
       x = "Número de quartos") +
  scale_x_discrete(limits = 1:7)+  # Limitar o eixo x até o valor 7
  theme(legend.position = "none")
```


```{r}
tabela_frequencias <- as.data.frame(dados) %>%
  group_by(X4) %>%
  dplyr::summarise(frequencia = n()) %>%
  mutate(percentual = frequencia / sum(frequencia) * 100)
colnames(tabela_frequencias) = c("Número de banheiros","Frequencia","Porcentual")
```

```{r, results = "asis", eval=ifelse(nzchar(system.file(package = "xtable")), TRUE, FALSE)}
xt <- xtable(tabela_frequencias, caption = "Tabela de frequencia do Número de banheiros", 
  label = "tab:xtable_tab")
print(xt, comment = FALSE, caption.placement = "top", booktabs = TRUE)
```

```{r}
shapiro.test(dados$X4)
```

A quarta variável, número de banheiros segue os mesmos princípios da quarta variável e tem como dados: 
Número de banheiros	Quantidade
0	1
1	71
2	170
3	174
4	83
5	17
6	11
7	2

\newpage

### Presença de Ar-Condicionado - X5

```{r}
ggplot(dados, aes(x = factor(X5), y = x1, fill = factor(X5))) +
  geom_boxplot() +
  theme_classic() +
  labs(title = "Box Plot - Valor da Casa por Ar Condicionado",
       x = "Presença de Ar Condicionado",
       y = "Valor da Casa") +
  scale_fill_manual(values = c("0" = "blue", "1" = "steelblue"),
                    labels = c("Não", "Sim"))
```


```{r}
tabela_frequencias <- as.data.frame(dados) %>%
  group_by(X5) %>%
  dplyr::summarise(frequencia = n()) %>%
  mutate(percentual = frequencia / sum(frequencia) * 100)
colnames(tabela_frequencias) = c("Ar Condicionado","Frequencia","Porcentual")
```

```{r, results = "asis", eval=ifelse(nzchar(system.file(package = "xtable")), TRUE, FALSE)}
xt <- xtable(tabela_frequencias, caption = "Tabela de frequencia do Ar Condicionado", 
  label = "tab:xtable_tab")
print(xt, comment = FALSE, caption.placement = "top", booktabs = TRUE)
```

A presença de ar-condicionado foi selecionada como a quinta variável, sendo essa uma variável qualitativa, com 1 para o caso de haver e 0 para quando não há ar condicionado na residência. 

\newpage

### Tamanho da Garagem - X6

```{r}
cores_azul <- c("#1f77b4", "#aec7e8", "#9edae5", "#3182bd", "#6baed6", "#bdd7e7", "#6baed6")

# Criar o box plot com cores em tons de azul e remover a legenda lateral
ggplot(dados, aes(x = factor(X6), y = X1, fill = factor(X6))) +
  geom_boxplot() +
  scale_fill_manual(values = cores_azul, name = "Número de banheiros") +
  theme_classic() +
  labs(title = "Box Plot - Número de carros que podem ser guardados na garagem",
       y = "Valor da casa",
       x = "Número de carros") +
  scale_x_discrete(limits = 1:7) +
  theme(legend.position = "none")  # Remover a legenda lateral das cores
```

```{r}
tabela_frequencias <- as.data.frame(dados) %>%
  group_by(X6) %>%
  dplyr::summarise(frequencia = n()) %>%
  mutate(percentual = frequencia / sum(frequencia) * 100)
colnames(tabela_frequencias) = c("Número de Garagens","Frequencia","Porcentual")
```

```{r, results = "asis", eval=ifelse(nzchar(system.file(package = "xtable")), TRUE, FALSE)}
xt <- xtable(tabela_frequencias, caption = "Tabela de frequencia do Tamanho da Garagem", 
  label = "tab:xtable_tab")
print(xt, comment = FALSE, caption.placement = "top", booktabs = TRUE)
```

```{r}
shapiro.test(dados$X6)
```



O tamanho da garagem, sexta variável, mede em número de carros o tamanho da garagem da casa, para casas que não possuem garagem o valor 0 foi imputado, a tabela abaixo é referente aos dados da variável:


Número de carros	Quantidade
0	7
1	52
2	351
3	106
4	2
5	1
6	0
7	1

\newpage

### Piscina - X7

```{r}
ggplot(dados, aes(x = factor(X7), y = x1, fill = factor(X7))) +
  geom_boxplot() +
  theme_classic() +
  labs(title = "Box Plot - Valor da Casa com Presença de piscina",
       x = "Presença de piscina",
       y = "Valor da Casa") +
  scale_fill_manual(values = c("0" = "blue", "1" = "steelblue"),
                    labels = c("Não", "Sim"))
```

```{r}
tabela_frequencias <- as.data.frame(dados) %>%
  group_by(X7) %>%
  dplyr::summarise(frequencia = n()) %>%
  mutate(percentual = frequencia / sum(frequencia) * 100)
colnames(tabela_frequencias) = c("Presença de piscina","Frequencia","Porcentual")
```

```{r, results = "asis", eval=ifelse(nzchar(system.file(package = "xtable")), TRUE, FALSE)}
xt <- xtable(tabela_frequencias, caption = "Tabela de frequencia da Presença de piscina", 
  label = "tab:xtable_tab")
print(xt, comment = FALSE, caption.placement = "top", booktabs = TRUE)
```

A sétima variável avalia se a casa possui piscina, sendo essa outra variável qualitativa, com 1 para o caso de haver e 0 para quando não há piscina na residência. 

\newpage

### Idade do Imóvel - X8

```{r}
# Supondo que o ano atual é 2023 e a coluna com o ano de nascimento é chamada "x8"
ano_atual <- 2023

dados <- dados %>%
  mutate(idade = ano_atual - dados$X8)

hist(dados$idade,
     main = "Histograma da idade da casa", 
     xlab = "Idade da casa ",
     col = "steelblue",  # Cor das barras
     border = "white",   # Cor das bordas das barras
     breaks =         # Número de bins
)
```

```{r}

ggplot(dados,aes(dados$X1,dados$idade, color = I("steelblue"))) + 
  geom_point() + 
  theme_classic()+
  stat_cor(method = "pearson")+ 
  labs(title = "Gráfico de Dispersão - Idade da casa", y = "Valor da casa", x="Idade da casa")
```

```{r}
shapiro.test(dados$idade)
```

A variável idade do imóvel foi retirada com base no dado apresentado de ano de construção, foi usado como base o ano de 2023 para realizarmos a medição dessa variável, nota-se que essa é a variável explicativa com uma grande distribuição de valores, conforme observado no gráfico abaixo:

\newpage

### Qualidade de Construção - X9

```{r}
ggplot(dados, aes(x = factor(X9), y = x1, fill = factor(X9))) +
  geom_boxplot() +
  theme_classic() +
  labs(title = "Box Plot - Valor da Casa por qualidade da construção",
       x = "Qualidade da construção",
       y = "Valor da Casa") +
  scale_fill_manual(values = c("1" = "blue", "2" = "steelblue", "3" ="lightblue"),
                    labels = c("Alta qualidade", "Média qualidade", "Baixa qualidade"))
```

```{r}
tabela_frequencias <- as.data.frame(dados) %>%
  group_by(X9) %>%
  dplyr::summarise(frequencia = n()) %>%
  mutate(percentual = frequencia / sum(frequencia) * 100)
colnames(tabela_frequencias) = c("qualidade da construção","Frequencia","Porcentual")
```

```{r, results = "asis", eval=ifelse(nzchar(system.file(package = "xtable")), TRUE, FALSE)}
xt <- xtable(tabela_frequencias, caption = "Tabela de frequencia da qualidade da construção", 
  label = "tab:xtable_tab")
print(xt, comment = FALSE, caption.placement = "top", booktabs = TRUE)
```

A Qualidade da construção foi selecionada sendo uma variável qualitativa, que tenta mensurar a qualidade do material empregado na construção, essa variável conta com bastante subjetividade por parte do avaliador, sendo pontuada com 1 para o alta qualidade, 2 para média qualidade e 3 para imóveis de construção avaliados como baixa qualidade. 

\newpage

### Tamanho do Terreno - X10

```{r}
#histograma do tamanho do terreno
hist(dados$X10,
     main = "Histograma do Tamanho do terreno", 
     xlab = "Tamanho do terreno",
     col = "steelblue",  # Cor das barras
     border = "white",   # Cor das bordas das barras
     breaks =         # Número de bins
)

```

```{r}
ggplot(dados,aes(dados$X1,dados$X10, color = I("steelblue"))) + 
  geom_point() + 
  theme_classic()+
  stat_cor(method = "pearson")+ 
  labs(title = "Gráfico de Dispersão - Tamanho do terreno", y = "Valor da casa", x="Tamanho do terreno")
```

```{r}
shapiro.test(dados$X10)
```

\newpage

### Proximidade da "Highway" - X11

```{r}
ggplot(dados, aes(x = factor(X11), y = x1, fill = factor(X11))) +
  geom_boxplot() +
  theme_classic() +
  labs(title = "Box Plot - Valor da Casa com proximidade da “highway",
       x = "Presença de piscina",
       y = "Valor da Casa") +
  scale_fill_manual(values = c("0" = "blue", "1" = "steelblue"),
                    labels = c("Não", "Sim"))

```

```{r}
tabela_frequencias <- as.data.frame(dados) %>%
  group_by(X11) %>%
  dplyr::summarise(frequencia = n()) %>%
  mutate(percentual = frequencia / sum(frequencia) * 100)
colnames(tabela_frequencias) = c("proximidade da highway","Frequencia","Porcentual")
```

```{r, results = "asis", eval=ifelse(nzchar(system.file(package = "xtable")), TRUE, FALSE)}
xt <- xtable(tabela_frequencias, caption = "Tabela de frequencia da proximidade da highway", 
  label = "tab:xtable_tab")
print(xt, comment = FALSE, caption.placement = "top", booktabs = TRUE)
```

Por último, a variável proximidade da "Highway" avalia se a casa se encontra próxima ou distante da avenida.

## Modelagem

### Correlação entre as Variaveis

```{r}
x = round(cor(dados[,c(2,3,4,6,8,10)]),3)

ggcorrplot::ggcorrplot(x,lab = TRUE)
```




\newpage

# Conclusão









